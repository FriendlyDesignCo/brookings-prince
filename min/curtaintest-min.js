$.fn.Article=function(){function n(n){n.preventDefault();var e=$(n.currentTarget).attr("href"),t=$(e).parents(".section"),o=t.index()-1;p=o,console.log(p);var r=a();r.length>1?(m++,m<r.length?r.each(function(n){n==m&&(console.log("scrolling..."),$.Scroll.stop().animate({scrollTop:u[p].min+$(this).height()*n},600,"easeOutQuart"))}):(m=0,i(n))):(m=0,i(n)),console.log(p)}function e(n){n.preventDefault();var e=a();e.length>1?(m++,m<e.length?e.each(function(n){n==m&&$.Scroll.stop().animate({scrollTop:u[p].min+$(this).height()*n},600,"easeOutQuart")}):(m=0,i(n))):(m=0,i(n))}function t(n){n.preventDefault();var e=a();e.length>1?(m--,m>=0?e.each(function(n){n==m&&$.Scroll.stop().animate({scrollTop:u[p].min+$(this).height()*n},600,"easeOutQuart")}):(m=0,o(n))):(m=0,o(n))}function i(n){p++,p>=v&&(p=v-1),n.preventDefault(),r(p)}function o(n){p--,0>p&&(p=0),n.preventDefault(),r(p)}function r(n){$.Scroll.stop().animate({scrollTop:u[n].min},600,"easeOutQuart")}function a(){var n={};return d.each(function(e){e==p&&(n=$(this).find("figure p.anchor"))}),n}function s(n){}function l(n,e,t,i){}function c(){E=0,d.triggerHandler($.Events.RESIZE),g()}function h(){var n=window.orientation;d.triggerHandler($.Events.ORIENT,n)}function g(){$.MobileDevice||$.Body.css({height:E})}var d=this,u=new Array,E=0,f=$.Body.attr("data-issue"),v=this.length,T=0,p=0,m=0;return $.Body.bind($.Events.ARTICLE_NEXT,i).bind($.Events.ARTICLE_PREV,o).bind($.Events.ARTICLE_ENTER,l).bind($.Events.KEY_RIGHT,e).bind($.Events.KEY_DOWN,e).bind($.Events.KEY_LEFT,t).bind($.Events.KEY_UP,t),$.Window.bind("resize",c),$(".scroll").bind("click",n),window.onorientationchange=h,this.each(function(n){function e(){O=v?v.height():0,S=h?h.height():0,u[n]={min:E,max:E+r()},E+=r(),!A||$.MobileDevice||$.Tablet||(m.css({top:o()<$.Window.height()?o()/2:$.Window.height()/2}),b.css({top:o()<$.Window.height()?o()/2:$.Window.height()/2})),$.MobileDevice||(h.css({height:S}),c.css({height:o(),overflow:"hidden",zIndex:1e3-H}))}function t(n){var e=$.Window.scrollTop(),t=u[H],o=i(e);switch(o){case"page":c.css({marginTop:-(e-(t.min+S)),display:"block"}),h.css({marginTop:-(e-t.min)}),c.triggerHandler($.Events.ARTICLE_SCROLL,e-t.min);break;case"inview":h.css({marginTop:-(e-t.min)}),C!=o&&c.css({marginTop:0,display:"block"}),c.triggerHandler($.Events.ARTICLE_SCROLL,e-t.min);break;case"above":C!=o&&(h.css({marginTop:-S-25}),c.css({marginTop:-r()-25,display:"none"}),c.triggerHandler($.Events.ARTICLE_SCROLL,e-t.min));break;case"outofview":C!=o&&(c.triggerHandler($.Events.ARTICLE_SCROLL,0),h.css({marginTop:0}),c.css({marginTop:0,display:"none"}));break;default:C!=o&&(c.triggerHandler($.Events.ARTICLE_SCROLL,0),h.css({marginTop:0}),c.css({marginTop:0,display:"block"}))}C=o}function i(e){var t=u[H];return e>t.min&&e<=t.max?(c.hasClass("_inview")||(c.addClass("_inview"),$.Body.triggerHandler($.Events.ARTICLE_ENTER,[f,I,n])),e>=t.min+S?"page":"inview"):(c.hasClass("_inview")&&c.removeClass("_inview"),e<=t.min-$.Window.height()?(c.triggerHandler($.Events.ARTICLE_EXIT,[f,I,n]),"outofview"):e<=t.min?"below":e>t.max?(c.triggerHandler($.Events.ARTICLE_EXIT,[f,I,n]),"above"):void 0)}function o(){var n=$.Window.height(),e=$.Window.width();return y?a(y,e,n):$.MobileWebkit?S+250>n?S+250:n:n>O+50?n:O+50}function r(){var n=O+50<$.Window.height()?$.Window.height():O+50,e=$.Window.width();return y?a(y,e):S+n}function a(n,e){return 1200>=D*e?1200:D*e>1200?D*e:parseInt(n)}function s(e){e.preventDefault(),p==n&&(g.length>1?(L++,L<g.length?g.each(function(n){n==L&&$.Scroll.stop().animate({scrollTop:$(this).offset().top-250},600,"easeOutQuart")}):(L=0,setTimeout(function(){$.Body.triggerHandler($.Events.ARTICLE_NEXT)},100))):(L=0,setTimeout(function(){$.Body.triggerHandler($.Events.ARTICLE_NEXT)},100)))}function l(e){e.preventDefault(),p==n&&(g.length>1?(L--,L>=0?g.each(function(n){n==L&&$.Scroll.stop().animate({scrollTop:$(this).offset().top-250},600,"easeOutQuart")}):(L=0,setTimeout(function(){$.Body.triggerHandler($.Events.ARTICLE_PREV)},100))):(L=0,setTimeout(function(){$.Body.triggerHandler($.Events.ARTICLE_PREV)},100)))}var c=$(this),h=c.find("figure"),g=h.children(),v=c.find(".column"),m=c.find("header"),w=c.find(".numeral"),b=c.find(".extras"),R=c.find("[data-video]"),C="",L=0,I=c.attr("data-google"),_=c.hasClass("title-page"),A=c.hasClass("chapter"),W=c.hasClass("fullscreen"),H=n,y=c.attr("data-height"),O=v?v.height():0,S=h?h.height():0,D=1200/1440;d.bind($.Events.RESIZE,e).bind($.Events.ORIENT,e),R.length>0&&R.Video({scope:c}),e(),$.MobileWebkit||$.Window.bind("scroll",t),_||(T++,w.html("No. "+T))}),g(),this};